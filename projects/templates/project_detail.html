{% extends 'base.html' %}

{% block content %}
<h1>{{ project.title }}</h1>
<p>{{ project.details }}</p>
<p><strong>Category:</strong> {{ project.category }}</p>
<p><strong>Target:</strong> ${{ project.total_target }}</p>
<p><strong>Start:</strong> {{ project.start_time }}</p>
<p><strong>End:</strong> {{ project.end_time }}</p>
<p><strong>Created by:</strong>
    {% if project.creator %}
        {{ project.creator.username }}
    {% else %}
        Anonymous
    {% endif %}
</p>

<hr>

<h2>Project Image</h2>

{% if project.image %}
  <img src="{{ project.image.url }}" alt="Project Image" style="max-width: 300px;" />
{% else %}
  <p>No image available.</p>
{% endif %}



<hr>

<h2>Donations</h2>
<p><strong>Total Donations:</strong> ${{ total_donations|default:"0.00" }}</p>
<ul>
    {% for donation in project.donations.all %}
        <li>
            {% if donation.user %}
                {{ donation.user.username }}
            {% else %}
                Anonymous
            {% endif %}
            donated ${{ donation.amount }}
        </li>
    {% empty %}
        <li>No donations yet.</li>
    {% endfor %}
</ul>

<h3>Donate to this Project</h3>
<form method="post">
    {% csrf_token %}
    {{ donation_form.as_p }}
    <button type="submit" name="donate">Donate</button>
</form>

<hr>

<h2>Ratings</h2>
<p><strong>Average Rating:</strong> {{ project.average_rating|floatformat:1 }}/5</p>
<ul>
    {% for rating in project.ratings.all %}
        <li>
            {% if rating.user %}
                {{ rating.user.username }}
            {% else %}
                Anonymous
            {% endif %}
            rated: {{ rating.value }}/5
        </li>
    {% empty %}
        <li>No ratings yet.</li>
    {% endfor %}
</ul>

<h3>Rate this Project</h3>
<form method="post">
    {% csrf_token %}
    {{ rating_form.as_p }}
    <button type="submit" name="rate">Rate</button>
</form>

<hr>

<h2>Comments</h2>
<ul>
    {% for comment in project.comments.all %}
        <li>
            <strong>
                {% if comment.user %}
                    {{ comment.user.username }}
                {% else %}
                    Anonymous
                {% endif %}
            </strong>: {{ comment.text }}

            <!-- عرض الردود على التعليق -->
            {% for reply in comment.replies.all %}
                <ul>
                    <li>
                        <em>
                            {% if reply.user %}
                                {{ reply.user.username }}
                            {% else %}
                                Anonymous
                            {% endif %}
                        </em>: {{ reply.text }}
                    </li>
                </ul>
            {% endfor %}
        </li>
    {% empty %}
        <li>No comments yet.</li>
    {% endfor %}
</ul>

<h3>Leave a Comment</h3>
<form method="post">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit" name="comment">Post Comment</button>
</form>

{% endblock %}
