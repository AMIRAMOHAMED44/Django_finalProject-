<!--<nav class="navbar navbar-expand-lg navbar-light bg-light">-->
<!--  <div class="container-fluid">-->
<!--    <a class="navbar-brand" href="#">Crowdfunding Platform</a>-->
<!--    <button-->
<!--      class="navbar-toggler"-->
<!--      type="button"-->
<!--      data-bs-toggle="collapse"-->
<!--      data-bs-target="#navbarSupportedContent"-->
<!--      aria-controls="navbarSupportedContent"-->
<!--      aria-expanded="false"-->
<!--      aria-label="Toggle navigation"-->
<!--    >-->
<!--      <span class="navbar-toggler-icon"></span>-->
<!--    </button>-->
<!--    <div class="collapse navbar-collapse" id="navbarSupportedContent">-->
<!--      <ul class="navbar-nav me-auto mb-2 mb-lg-0">-->
<!--        <li class="nav-item">-->
<!--          <a class="nav-link active" aria-current="page" href="{% url 'home' %}"-->
<!--            >Home</a-->
<!--          >-->
<!--        </li>-->
<!--        <li class="nav-item dropdown">-->
<!--          <a-->
<!--            class="nav-link dropdown-toggle"-->
<!--            href="#"-->
<!--            id="projectsDropdown"-->
<!--            role="button"-->
<!--            data-bs-toggle="dropdown"-->
<!--            aria-expanded="false"-->
<!--          >-->
<!--            Projects-->
<!--          </a>-->
<!--          <ul class="dropdown-menu" aria-labelledby="projectsDropdown">-->
<!--            <li>-->
<!--              <a class="dropdown-item" href="{% url 'project_list' %}">List</a>-->
<!--            </li>-->
<!--            <li>-->
<!--              <a class="dropdown-item" href="{% url 'create_project' %}"-->
<!--                >Create</a-->
<!--              >-->
<!--            </li>-->
<!--          </ul>-->
<!--        </li>-->
<!--        <li class="nav-item">-->
<!--          <a class="nav-link" href="{% url 'signup' %}">Register</a>-->
<!--        </li>-->
<!--      </ul>-->
<!--      <form class="d-flex">-->
<!--        <input-->
<!--          class="form-control me-2"-->
<!--          type="search"-->
<!--          placeholder="Search"-->
<!--          aria-label="Search"-->
<!--        />-->
<!--        <button class="btn btn-outline-primary" type="submit">Search</button>-->
<!--      </form>-->
<!--    </div>-->
<!--  </div>-->
<!--</nav>-->


{% load static %}

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'home' %}">Crowdfunding Platform</a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="{% url 'home' %}">Home</a>
        </li>
        <li class="nav-item dropdown">
          <a
            class="nav-link dropdown-toggle"
            href="#"
            id="projectsDropdown"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            Projects
          </a>
          <ul class="dropdown-menu" aria-labelledby="projectsDropdown">
            <li>
              <a class="dropdown-item" href="{% url 'project_list' %}">Browse Projects</a>
            </li>
            {% if user.is_authenticated %}
            <li>
              <a class="dropdown-item" href="{% url 'create_project' %}">Create Project</a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item" href="{% url 'profile' %}">My Projects</a>
            </li>
            {% endif %}
          </ul>
        </li>
      </ul>

      <div class="d-flex align-items-center">
        <!-- Stable Search Form -->
        <form class="search-container me-3" >
          <div class="input-group stable-search-group">
            <input
              class="form-control search-input"
              type="search"
              name="q"
              placeholder="Search projects..."
              aria-label="Search"
              value="{{ request.GET.q }}"
            />
            <button class="btn btn-outline-primary" type="submit">Search</button>

          </div>
        </form>

        {% if user.is_authenticated %}
        <!-- Stable User Dropdown -->
        <div class="dropdown user-dropdown">
          <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle"
             id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <div class="avatar-container position-relative me-2">
              <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'images/default_profile.png' %}{% endif %}"
                    class="avatar-image"
                    alt="Profile"
                    onerror="this.src='{% static 'images/default_profile.png' %}'">
            </div>
            <span class="username">{{ user.first_name|default:user.username }}</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="{% url 'profile' %}"><i class="fas fa-user me-2"></i>My Profile</a></li>
            <li><a class="dropdown-item" href="{% url 'edit_profile' %}"><i class="fas fa-edit me-2"></i>Edit Profile</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="{% url 'logout' %}"><i class="fas fa-sign-out-alt me-2"></i>Sign Out</a></li>
          </ul>
        </div>
        {% else %}
        <!-- Guest Links -->
        <div class="btn-group auth-buttons">
          <a href="{% url 'login' %}" class="btn btn-outline-primary"><i class="fas fa-sign-in-alt me-1"></i> Login</a>
          <a href="{% url 'signup' %}" class="btn btn-primary"><i class="fas fa-user-plus me-1"></i> Register</a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</nav>

<style>
  /* Search Bar Styling */
  .search-container {
    min-width: 250px;
    max-width: 400px;
    flex-grow: 1;
  }

  .stable-search-group {
    transition: none;
  }

  .search-input {
    border-radius: 20px 0 0 20px !important;
    border-right: none;
    transition: none;
  }

  .search-btn {
    border-radius: 0 20px 20px 0 !important;
    transition: none;
  }

  /* User Dropdown Styling */
  .user-dropdown {
    min-width: 50px;
  }

  .avatar-container {
    width: 36px;
    height: 36px;
  }

  .avatar-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: none;
  }

  .username {
    max-width: 120px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: none;
  }

  /* Auth Buttons */
  .auth-buttons .btn {
    padding: 0.375rem 0.75rem;
  }

  /* Responsive Adjustments */
  @media (min-width: 768px) {
    .username {
      display: inline;
    }

    .auth-buttons .btn {
      padding: 0.375rem 1rem;
    }
  }

  @media (max-width: 576px) {
    .search-container {
      width: 100%;
      margin-bottom: 0.5rem;
    }

    .navbar-collapse {
      padding-top: 1rem;
    }
  }
</style>